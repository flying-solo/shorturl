import Head from "next/head";
import { useState } from "react";
import axios from "axios";
import { Player } from "@lottiefiles/react-lottie-player";
import { urlValidate } from "../middleware/validate";

export default function Home() {
  const [url, setUrl] = useState("");
  const [urlError, setUrlError] = useState(false);
  const [errorMsg, setErrorMsg] = useState("Shorten");
  const [shortUrl, setShortUrl] = useState("");

  const handleSubmit = async () => {
    await urlValidate
      .validate({ url })
      .then((res) => {
        axios
          .post("/api/shorten", { url })
          .then((result) => {
            setShortUrl(result.data);
          })
          .catch((err) => {
            console.log("Error -> index.tsx -> post", err);
          });
      })
      .catch((err) => {
        setErrorMsg(err.errors[0]);
        setUrlError(true);
      });
  };

  return (
    <>
      <Head>
        <title>URL Shortner</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="font-sophia h-screen flex flex-col justify-between py-12 items-center bg-[#121212]">
        <div className="font-bold text-[3rem] text-transparent text-8xl bg-clip-text hover:cursor-crosshair bg-gray-300 hover:bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500">
          Shorten Your Url
        </div>
        <div className="flex flex-col items-center gap-4">
          <div className="flex gap-4">
            <input
              type="text"
              value={url}
              placeholder="Enter your Link"
              className={`text-gray-200 outline-none px-5 py-2 border-b-2 border-b-gray-300 bg-[#121212] text-lg shadow-sm placeholder-[#8f8f8f] w-[50vw]`}
              onChange={(e) => {
                setUrl(e.target.value);
                setUrlError(false);
                setErrorMsg("Shorten");
              }}
            />
          </div>
          <button
            disabled={urlError}
            className={`${
              urlError
                ? "bg-red-600 hover:cursor-not-allowed opacity-70"
                : " bg-amber-600"
            } text-[#121212] text-lg px-5 py-[0.3rem] font-semibold mt-`}
            onClick={handleSubmit}
          >
            {errorMsg}
          </button>
        </div>
        <div className="text-blue-700 bg-[#121212] hover:text-purple-900 hover:cursor-pointer">
            <a href={shortUrl} target="_blank" rel="noreferrer">
              {shortUrl}
            </a>
        </div>
      </main>
    </>
  );
}
